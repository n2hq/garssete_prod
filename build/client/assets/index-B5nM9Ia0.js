import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-BgCvqN9p.js";import{A as C}from"./AccountLayout-CeaolRpb.js";import{u as I}from"./AuthContext-CJZGuvtq.js";import{s as T,N as A,O as L,n as R}from"./lib-B5CJHXEq.js";import{u as O,s as U}from"./zod-VB2z1YQj.js";import{I as b,B as V}from"./Input-DwYSWibS.js";import{z as i}from"./index-C4bLmoCR.js";import{f as k,g as B}from"./UserMenu-BGcyOhXR.js";import{u as F}from"./NotificationContext-DexQTEg0.js";import{u as W}from"./OperationContext-C5fIEC6d.js";import{P as Z}from"./ProfileContentLayout-7tfcJpjO.js";import{L as _}from"./LoadingMessage-Dr-y0iSu.js";import"./HomeNav-C4_KFq1z.js";import"./SrchNavbar-pdnUqn3L.js";import"./HamburgerSecondary-BXRtfWu4.js";import"./json-BNGep5mz.js";import"./index-Bmix0W_x.js";import"./BusinessMenu-Bt_k1cKU.js";const y=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),$=i.object({oldpassword:i.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(y,{message:"Please enter a valid password"}),newpassword:i.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(y,{message:"Please enter a valid password"}),newpassword2:i.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(y,{message:"Please enter a valid password"})}).superRefine((r,e)=>{r.oldpassword===r.newpassword&&e.addIssue({code:i.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),r.newpassword!==r.newpassword2&&e.addIssue({code:i.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),z=({loaderData:r,user:e})=>{var E;const[d,f]=t.useState(null),[a,p]=t.useState(!1);F();const{showOperation:w,showError:u,completeOperation:n,showSuccess:c}=W(),m=o=>{let P=o.target.value,j=o.target.name;f(g=>({...g,[j]:P}))},S=async o=>{var g;p(!0),w("processing"),await new Promise(l=>setTimeout(l,1e3));const P="/api/user/change_password/"+((g=r.userProfile)==null?void 0:g.user_guid),j=A.BASE_URL+P;o.password=o==null?void 0:o.newpassword,delete o.oldpassword,delete o.newpassword,delete o.newpassword2;try{const l=await fetch(j,{method:"PUT",headers:T,body:JSON.stringify(o)});if(l.ok)c("Success","Password changed. Use new password on next login."),n();else{let Y=l.json().then(v=>{u("Error",v.message),n()})}}catch(l){console.log(l.message),u("Error","Password change failed."),n()}finally{p(!1)}},{register:h,handleSubmit:N,getValues:D,setValue:q,watch:H,setError:J,formState:{errors:x,isSubmitting:M}}=O({defaultValues:r.listing,resolver:U($)});return s.jsx("form",{onSubmit:N(S),children:s.jsx("div",{className:`${k} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:s.jsxs("div",{className:B,children:[s.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),s.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[s.jsx("b",{children:(E=r.userProfile)==null?void 0:E.email})," is your current email. It will be used be used for password resets or changes."]}),s.jsx("div",{className:"mt-[20px]"}),s.jsx(b,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:h,changeHandler:m,error:x.oldpassword}),s.jsx(b,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:h,changeHandler:m,error:x.newpassword}),s.jsx(b,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:h,changeHandler:m,error:x.newpassword2}),s.jsx(V,{working:a})]})})})},ge=()=>{t.useEffect(()=>{L(localStorage)},[]);const r=I();if(!r)return null;const{user:e}=r,[d,f]=t.useState(null),[a,p]=t.useState(null),[w,u]=t.useState(!0);return t.useEffect(()=>{async function n(c){const m=await R(c||"");f(m)}try{e!=null&&e.guid&&n(e==null?void 0:e.guid)}catch(c){console.log(c.message)}},[e==null?void 0:e.guid]),t.useEffect(()=>{if(d&&e){const n={userProfile:d,...e};p(n)}},[d,e]),t.useEffect(()=>{a&&u(!1)},[a]),w?s.jsx(_,{loading:w}):s.jsx(C,{children:s.jsxs(Z,{title:"Change Password",data:a,children:[d===null?"Loading...":"",a&&s.jsx(z,{loaderData:a,user:e})]})})};export{ge as default};
