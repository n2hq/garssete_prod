import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-BgCvqN9p.js";import{A as C}from"./AccountLayout-BIy1x3tk.js";import{u as O}from"./AuthContext-jYNbaFtL.js";import{s as I,N as k,O as U,n as W}from"./lib-yTOo7XCn.js";import{u as _,s as q}from"./zod-VB2z1YQj.js";import{I as B,B as F}from"./Input-CchXA7HL.js";import{z as S}from"./index-C4bLmoCR.js";import{f as R,g as T}from"./UserMenu-XeS_t7cM.js";import{u as V}from"./NotificationContext-BYch09_4.js";import{u as z}from"./OperationContext-C5fIEC6d.js";import{P as H}from"./ProfileContentLayout-C-akFgwM.js";import{L as J}from"./LoadingMessage-CdG0jjBH.js";import"./HomeNav-DGIKRWzI.js";import"./SrchNavbar-3NYx9nnR.js";import"./HamburgerSecondary-BwwaPQMk.js";import"./json-DZIPjdM1.js";import"./index-WNiYugoE.js";import"./BusinessMenu-rWF8Hvd0.js";const M=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),$=({loaderData:r,user:s})=>{var E,w;const[i,p]=t.useState(null),[a,n]=t.useState(!1);V();const[g,x]=t.useState(!0),{showOperation:c,showSuccess:l,showError:m,showWarning:D,showInfo:G,completeOperation:d}=z(),P=o=>{let j=o.target.value,h=o.target.name;p(f=>({...f,[h]:j}))},y=async o=>{var f,b;if(n(!0),c("processing"),await new Promise(u=>setTimeout(u,1e3)),o.email===((f=r.userProfile)==null?void 0:f.email))return m("Error","Email is in use. Enter a new email."),d(),n(!1),!1;const h=k.BASE_URL+"/api/user/change_email_request";o.guid=(b=r.userProfile)==null?void 0:b.user_guid;try{const u=await fetch(h,{method:"POST",headers:I,body:JSON.stringify(o)});if(u.ok)l("Success","Please check your new email to continue."),d();else{let ee=u.json().then(A=>{m("Error",A.message),d()})}}catch{m("Error","Change request failed"),d()}finally{n(!1)}},{register:N,handleSubmit:v,getValues:K,setValue:Q,watch:X,setError:Y,formState:{errors:L,isSubmitting:Z}}=_({defaultValues:r.listing,resolver:q(M)});return e.jsx("form",{onSubmit:v(y),children:e.jsx("div",{className:`${R} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:T,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(E=r.userProfile)==null?void 0:E.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(w=r.userProfile)==null?void 0:w.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(B,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:N,changeHandler:P,error:L.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(F,{working:a})]})})})},je=()=>{t.useEffect(()=>{U(localStorage)},[]);const r=O();if(!r)return null;const{user:s}=r,[i,p]=t.useState(null),[a,n]=t.useState(null),[g,x]=t.useState(!0);return t.useEffect(()=>{async function c(l){const m=await W(l||"");p(m)}try{s!=null&&s.guid&&c(s==null?void 0:s.guid)}catch(l){console.log(l.message)}},[s==null?void 0:s.guid]),t.useEffect(()=>{i&&n({userProfile:i})},[i]),t.useEffect(()=>{a&&x(!1)},[a]),g?e.jsx(J,{loading:g}):e.jsx(C,{children:e.jsxs(H,{title:"Email Address",children:[i===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),a&&e.jsx($,{loaderData:a,user:s})]})})};export{je as default};
