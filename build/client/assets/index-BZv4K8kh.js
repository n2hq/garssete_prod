import{j as t}from"./jsx-runtime-0DLF9kdB.js";import{r as s,a as O}from"./components-t0No8UbM.js";import{A as q}from"./AccountLayout-DBMAEIFw.js";import{u as G}from"./AuthContext-DiZM8Ihb.js";import{u as Q,s as X}from"./zod-D-KQcxjf.js";import{a5 as ee,a6 as $,a7 as k,s as te,V as se,W as oe,a8 as re,a9 as ne,n as ae}from"./lib-BT3-1uX3.js";import{I as g,B as ie}from"./Input-4a3NgM78.js";import{S as w}from"./Select-DNNws2m0.js";import{f as ce,c as le}from"./UserMenu-DrxnraDn.js";import{p as me,T as de}from"./TextareaWithWordLimit-BIEwQ_Vz.js";import{z as o}from"./index-C4bLmoCR.js";import{u as ue}from"./NotificationContext-1jS5Nfi7.js";import{u as ge,O as fe}from"./OperationContext-BXLbD7tl.js";import{P as he}from"./ProfileContentLayout-BzJmAScy.js";import{L as pe}from"./LoadingMessage-DZ85Xo9V.js";import"./HomeNav-B6uN5o21.js";import"./SrchNavbar-CF-Acj45.js";import"./HamburgerSecondary-C327styB.js";import"./json-DeAxj4L5.js";import"./index-C3rlSFmg.js";import"./BusinessMenu-uzVQD1wl.js";const ye=o.object({title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),pagetype:o.string({message:"Please select page type"}).min(1,{message:"Please select page type"}),category:o.string().min(1,{message:"Please select a business category."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),state_code:o.any(),city_id:o.any(),zipcode:o.string().max(7,{message:"Zipcode must not be more than 7 characters"}).optional().or(o.literal("")),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),address_two:o.any(),established:o.string().optional().refine(e=>!e||/^\d{1,4}$/.test(e),{message:"Must be only numbers and not more than 4 digits"})}).superRefine((e,c)=>{var h,d;((h=e==null?void 0:e.address_two)==null?void 0:h.length)!==0&&((d=e==null?void 0:e.address_two)==null?void 0:d.length)<3&&c.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),we=({data:e,user:c})=>{const[h,d]=s.useState(null),[_,p]=s.useState(!1);ue(),O();const{showOperation:S,showSuccess:y,showError:N,showWarning:J,showInfo:W,completeOperation:P}=ge(),T=e.countries;let[x,I]=s.useState(e.states),[z,j]=s.useState(e.cities);const C=ee,[l,A]=s.useState(""),[D,B]=s.useState(""),[b,v]=s.useState(""),[R,U]=s.useState(""),V=async i=>{A(i),v(i);const f=await $(i);I(f),Y("")},Y=async i=>{B(i),U(i);const f=await k(l,i);j(f)},r=i=>{let f=i.target.value,L=i.target.name;d(m=>({...m,[L]:f}))},Z=async i=>{p(!0),S("processing","Creating a page"),await new Promise(u=>setTimeout(u,1e3)),i.owner=c.guid;const L=se.BASE_URL+"/api/listing";try{const u=await fetch(L,{method:"POST",headers:te,body:JSON.stringify(i)});if(u.ok)y("success","Page created successfully."),S("processing","Redirecting..."),await new Promise(K=>setTimeout(K,4e3)),window.location.href="/web/account/portfolio",P();else{var m=await u.json();throw new Error(`Error Code: ${u.status} - ${(m==null?void 0:m.message)||(m==null?void 0:m.error)}`)}}catch(u){N("Error",u.message),P()}finally{p(!1)}},{register:n,handleSubmit:F,getValues:M,watch:H,setValue:E,setError:Se,formState:{errors:a,isSubmitting:Pe}}=Q({resolver:X(ye)});return s.useEffect(()=>{b&&(E("state_code",""),E("city_id",""))},[b]),s.useEffect(()=>{R&&E("city_id","")},[R]),t.jsx("form",{onSubmit:F(Z),children:t.jsxs("div",{className:`${ce} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto `,children:[t.jsx(g,{controlTitle:"Business Name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:r,error:a.title,width:80,controlInformation:"Business name is compulsory."}),t.jsx(w,{controlTitle:"Page Type",controlName:"pagetype",controlPlaceholder:"Select Page Type",selectJson:me,register:n,changeHandler:r,error:a.pagetype,controlInformation:"Select business category."}),t.jsx(g,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:r,error:a.email_address,controlInformation:"Email address is compulsory."}),t.jsx(w,{controlTitle:"Business Category",controlName:"category",controlPlaceholder:"Select business category",selectJson:C,register:n,changeHandler:r,error:a.category,controlInformation:"Select business category."}),t.jsx(g,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:r,error:a.address_one,width:100,controlInformation:"Address of Business. E.g. 28 New York Street "}),t.jsx(g,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:r,error:a.address_two,width:100,controlInformation:"Continuation of address. E.g. Crown Tower, Off Belleveu Avenue or Valu Complex, Kingston Donnel Boulevard. "}),t.jsx(w,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:T,register:n,changeHandler:r,error:a.country_code,setCode:V,controlInformation:"Country the business was registered or active. "}),t.jsx(w,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:x,register:n,changeHandler:r,error:a.state_code,setCode:Y,controlInformation:"State the business is registered or active. "}),t.jsx(w,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:z,register:n,changeHandler:r,error:a.city_id,controlInformation:"City the business is registered or active. "}),t.jsx(g,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:r,error:a.zipcode,controlInformation:"Zipcode of location of business. Eg. 92829 or 239484 "}),t.jsx(g,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:r,error:a.phone,controlInformation:"Phone OR Mobile number. "}),t.jsx(g,{controlTitle:"Year established - Optional",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:r,error:a.established,controlInformation:"Year registered is compulsory."}),t.jsx(de,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:r,error:a.short_description,setValue:E,getValues:M,watch:H,controlInformationClass:le,controlInformation:"Enter a short description of this business. It should be a maximum of 50 words. "}),t.jsx(ie,{working:_})]})})},Ue=()=>{s.useEffect(()=>{oe(localStorage)},[]);const e=G();if(!e)return null;const[c,h]=s.useState(null),[d,_]=s.useState(!0),[p,S]=s.useState(null),[y,N]=s.useState(null),[J,W]=s.useState(null),[P,T]=s.useState(null),[x,I]=s.useState(null),[z,j]=s.useState(null);return s.useEffect(()=>{const C=async l=>{const A=await re(),D=await $(""),B=await k("",""),b=await ne(),v=await ae((l==null?void 0:l.guid)||"");j(v),N(A),W(D),T(B),I(b),h(l)};try{e!=null&&e.user&&C(e==null?void 0:e.user)}catch(l){console.log(l.message)}},[e]),s.useEffect(()=>{c&&y&&x&&(S({user:c,countries:y,states:J,cities:P,categories:x}),_(!1))},[y,c]),d?t.jsx(pe,{loading:d}):t.jsx(q,{children:t.jsx(he,{title:"Create Page",children:t.jsx(fe,{children:p&&t.jsx("div",{children:t.jsx(we,{data:p,user:c})})})})})};export{Ue as default};
