import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-t0No8UbM.js";import{A as C}from"./AccountLayout-DBMAEIFw.js";import{u as I}from"./AuthContext-DiZM8Ihb.js";import{s as O,V as W,W as k,n as U}from"./lib-BT3-1uX3.js";import{u as V,s as _}from"./zod-D-KQcxjf.js";import{I as q,B}from"./Input-4a3NgM78.js";import{z as S}from"./index-C4bLmoCR.js";import{f as F,g as R}from"./UserMenu-DrxnraDn.js";import{u as T}from"./NotificationContext-1jS5Nfi7.js";import{u as z}from"./OperationContext-BXLbD7tl.js";import{P as H}from"./ProfileContentLayout-BzJmAScy.js";import{L as J}from"./LoadingMessage-DZ85Xo9V.js";import"./HomeNav-B6uN5o21.js";import"./SrchNavbar-CF-Acj45.js";import"./HamburgerSecondary-C327styB.js";import"./json-DeAxj4L5.js";import"./index-C3rlSFmg.js";import"./BusinessMenu-uzVQD1wl.js";const M=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),$=({loaderData:r,user:s})=>{var E,w;const[i,p]=t.useState(null),[a,n]=t.useState(!1);T();const[g,x]=t.useState(!0),{showOperation:c,showSuccess:l,showError:m,showWarning:D,showInfo:G,completeOperation:d}=z(),P=o=>{let j=o.target.value,h=o.target.name;p(f=>({...f,[h]:j}))},y=async o=>{var f,b;if(n(!0),c("processing"),await new Promise(u=>setTimeout(u,1e3)),o.email===((f=r.userProfile)==null?void 0:f.email))return m("Error","Email is in use. Enter a new email."),d(),n(!1),!1;const h=W.BASE_URL+"/api/user/change_email_request";o.guid=(b=r.userProfile)==null?void 0:b.user_guid;try{const u=await fetch(h,{method:"POST",headers:O,body:JSON.stringify(o)});if(u.ok)l("Success","Please check your new email to continue."),d();else{let ee=u.json().then(A=>{m("Error",A.message),d()})}}catch{m("Error","Change request failed"),d()}finally{n(!1)}},{register:v,handleSubmit:N,getValues:K,setValue:Q,watch:X,setError:Y,formState:{errors:L,isSubmitting:Z}}=V({defaultValues:r.listing,resolver:_(M)});return e.jsx("form",{onSubmit:N(y),children:e.jsx("div",{className:`${F} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:R,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(E=r.userProfile)==null?void 0:E.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(w=r.userProfile)==null?void 0:w.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(q,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:v,changeHandler:P,error:L.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(B,{working:a})]})})})},je=()=>{t.useEffect(()=>{k(localStorage)},[]);const r=I();if(!r)return null;const{user:s}=r,[i,p]=t.useState(null),[a,n]=t.useState(null),[g,x]=t.useState(!0);return t.useEffect(()=>{async function c(l){const m=await U(l||"");p(m)}try{s!=null&&s.guid&&c(s==null?void 0:s.guid)}catch(l){console.log(l.message)}},[s==null?void 0:s.guid]),t.useEffect(()=>{i&&n({userProfile:i})},[i]),t.useEffect(()=>{a&&x(!1)},[a]),g?e.jsx(J,{loading:g}):e.jsx(C,{children:e.jsxs(H,{title:"Email Address",children:[i===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),a&&e.jsx($,{loaderData:a,user:s})]})})};export{je as default};
