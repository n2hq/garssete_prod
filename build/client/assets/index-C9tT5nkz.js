import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-BgCvqN9p.js";import{A as C}from"./AccountLayout-CNNzrTDI.js";import{u as O}from"./AuthContext-CJZGuvtq.js";import{s as I,N as k,O as U,n as W}from"./lib-B5CJHXEq.js";import{u as _,s as q}from"./zod-VB2z1YQj.js";import{I as B,B as F}from"./Input-DwYSWibS.js";import{z as S}from"./index-C4bLmoCR.js";import{f as R,g as T}from"./UserMenu-BGcyOhXR.js";import{u as V}from"./NotificationContext-DexQTEg0.js";import{u as z}from"./OperationContext-C5fIEC6d.js";import{P as H}from"./ProfileContentLayout-7tfcJpjO.js";import"./HomeNav-C4_KFq1z.js";import"./SrchNavbar-DgQ69Q48.js";import"./HamburgerSecondary-BXRtfWu4.js";import"./json-BNGep5mz.js";import"./index-Bmix0W_x.js";import"./BusinessMenu-Bt_k1cKU.js";const J=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),$=({loaderData:r,user:s})=>{var E,j;const[i,p]=t.useState(null),[a,n]=t.useState(!1);V();const[h,x]=t.useState(!0),{showOperation:u,showSuccess:l,showError:m,showWarning:D,showInfo:G,completeOperation:d}=z(),P=o=>{let w=o.target.value,g=o.target.name;p(f=>({...f,[g]:w}))},y=async o=>{var f,b;if(n(!0),u("processing"),await new Promise(c=>setTimeout(c,1e3)),o.email===((f=r.userProfile)==null?void 0:f.email))return m("Error","Email is in use. Enter a new email."),d(),n(!1),!1;const g=k.BASE_URL+"/api/user/change_email_request";o.guid=(b=r.userProfile)==null?void 0:b.user_guid;try{const c=await fetch(g,{method:"POST",headers:I,body:JSON.stringify(o)});if(c.ok)l("Success","Please check your new email to continue."),d();else{let Z=c.json().then(L=>{m("Error",L.message),d()})}}catch{m("Error","Change request failed"),d()}finally{n(!1)}},{register:N,handleSubmit:v,getValues:K,setValue:M,watch:Q,setError:X,formState:{errors:A,isSubmitting:Y}}=_({defaultValues:r.listing,resolver:q(J)});return e.jsx("form",{onSubmit:v(y),children:e.jsx("div",{className:`${R} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:T,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(E=r.userProfile)==null?void 0:E.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(j=r.userProfile)==null?void 0:j.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(B,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:N,changeHandler:P,error:A.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(F,{working:a})]})})})},Ee=()=>{t.useEffect(()=>{U(localStorage)},[]);const r=O();if(!r)return null;const{user:s}=r,[i,p]=t.useState(null),[a,n]=t.useState(null),[h,x]=t.useState(!0);return t.useEffect(()=>{async function u(l){const m=await W(l||"");p(m)}try{s!=null&&s.guid&&u(s==null?void 0:s.guid)}catch(l){console.log(l.message)}},[s==null?void 0:s.guid]),t.useEffect(()=>{i&&n({userProfile:i})},[i]),t.useEffect(()=>{a&&x(!1)},[a]),h?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx("div",{className:"text-lg",children:"Loading..."})}):e.jsx(C,{children:e.jsxs(H,{title:"Email Address",children:[i===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),a&&e.jsx($,{loaderData:a,user:s})]})})};export{Ee as default};
