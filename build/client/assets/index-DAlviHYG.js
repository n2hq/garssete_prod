import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-BgCvqN9p.js";import{A as C}from"./AccountLayout-CNNzrTDI.js";import{u as I}from"./AuthContext-CJZGuvtq.js";import{s as T,N as A,O as R,n as L}from"./lib-B5CJHXEq.js";import{u as O,s as U}from"./zod-VB2z1YQj.js";import{I as y,B as V}from"./Input-DwYSWibS.js";import{z as i}from"./index-C4bLmoCR.js";import{f as k,g as B}from"./UserMenu-BGcyOhXR.js";import{u as F}from"./NotificationContext-DexQTEg0.js";import{u as W}from"./OperationContext-C5fIEC6d.js";import{P as Z}from"./ProfileContentLayout-7tfcJpjO.js";import"./HomeNav-C4_KFq1z.js";import"./SrchNavbar-DgQ69Q48.js";import"./HamburgerSecondary-BXRtfWu4.js";import"./json-BNGep5mz.js";import"./index-Bmix0W_x.js";import"./BusinessMenu-Bt_k1cKU.js";const b=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),_=i.object({oldpassword:i.string().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(b,{message:"Please enter a valid password"}),newpassword:i.string().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(b,{message:"Please enter a valid password"}),newpassword2:i.string().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(b,{message:"Please enter a valid password"})}).superRefine((r,e)=>{r.oldpassword===r.newpassword&&e.addIssue({code:i.ZodIssueCode.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),r.newpassword!==r.newpassword2&&e.addIssue({code:i.ZodIssueCode.custom,path:["newpd2"],message:"Your new password don't match"})}),$=({loaderData:r,user:e})=>{var N;const[d,g]=t.useState(null),[a,p]=t.useState(!1);F();const{showOperation:f,showError:w,completeOperation:n,showSuccess:c}=W(),m=o=>{let P=o.target.value,j=o.target.name;g(u=>({...u,[j]:P}))},E=async o=>{var u;p(!0),f("processing"),await new Promise(l=>setTimeout(l,1e3));const P="/api/user/change_password/"+((u=r.userProfile)==null?void 0:u.user_guid),j=A.BASE_URL+P;o.password=o==null?void 0:o.newpassword,delete o.oldpassword,delete o.newpassword,delete o.newpassword2;try{const l=await fetch(j,{method:"PUT",headers:T,body:JSON.stringify(o)});if(l.ok)c("Success","Password changed. Use new password on next login."),n();else{let Y=l.json().then(v=>{w("Error",v.message),n()})}}catch(l){console.log(l.message),w("Error","Password change failed."),n()}finally{p(!1)}},{register:h,handleSubmit:S,getValues:z,setValue:D,watch:q,setError:H,formState:{errors:x,isSubmitting:J}}=O({defaultValues:r.listing,resolver:U(_)});return s.jsx("form",{onSubmit:S(E),children:s.jsx("div",{className:`${k} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:s.jsxs("div",{className:B,children:[s.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),s.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[s.jsx("b",{children:(N=r.userProfile)==null?void 0:N.email})," is your current email. It will be used be used for password resets or changes."]}),s.jsx("div",{className:"mt-[20px]"}),s.jsx(y,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:h,changeHandler:m,error:x.oldpassword}),s.jsx(y,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:h,changeHandler:m,error:x.newpassword}),s.jsx(y,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:h,changeHandler:m,error:x.newpassword2}),s.jsx(V,{working:a})]})})})},we=()=>{t.useEffect(()=>{R(localStorage)},[]);const r=I();if(!r)return null;const{user:e}=r,[d,g]=t.useState(null),[a,p]=t.useState(null),[f,w]=t.useState(!0);return t.useEffect(()=>{async function n(c){const m=await L(c||"");g(m)}try{e!=null&&e.guid&&n(e==null?void 0:e.guid)}catch(c){console.log(c.message)}},[e==null?void 0:e.guid]),t.useEffect(()=>{if(d&&e){const n={userProfile:d,...e};p(n)}},[d,e]),t.useEffect(()=>{a&&w(!1)},[a]),f?s.jsx("div",{className:"flex justify-center items-center h-screen",children:s.jsx("div",{className:"text-lg",children:"Loading..."})}):s.jsx(C,{children:s.jsxs(Z,{title:"Change Password",data:a,children:[d===null?"Loading...":"",a&&s.jsx($,{loaderData:a,user:e})]})})};export{we as default};
