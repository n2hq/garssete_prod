import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as ie,w as ae}from"./components-BgCvqN9p.js";import{u as le}from"./AuthContext-CJZGuvtq.js";import{ai as ce,aj as ue,ak as me,al as de,a6 as ge,am as pe,N as W,J as fe,$ as he,a0 as te,a1 as oe,s as be,O as xe,n as we,U as Pe,a2 as ye,a3 as Se,A as je,an as _e,ao as Ie}from"./lib-B5CJHXEq.js";import{P as Ne}from"./ProfileLayout-FmRMW_ol.js";import{u as Ee,s as Ce}from"./zod-VB2z1YQj.js";import{z as o}from"./index-C4bLmoCR.js";import{u as q}from"./NotificationContext-DexQTEg0.js";import{u as H,O as ve}from"./OperationContext-C5fIEC6d.js";import{I as b,B as Be}from"./Input-DwYSWibS.js";import{f as Te,c as ee}from"./UserMenu-BGcyOhXR.js";import{T as se}from"./TextareaWithWordLimit-C9GEZXDF.js";import{S as F}from"./Select-Dky0vXRb.js";import{B as Ae}from"./BusinessMenu-Bt_k1cKU.js";import{B as De}from"./BusinessDrawer-DiqxpHSC.js";import{L as Oe}from"./LoadingMessage-Dr-y0iSu.js";import"./HomeNav-C4_KFq1z.js";import"./SrchNavbar-DgQ69Q48.js";import"./HamburgerSecondary-BXRtfWu4.js";import"./json-BNGep5mz.js";import"./index-Bmix0W_x.js";const Ue=o.object({username:o.any(),pagetype:o.string({message:"Please select page type"}).min(1,{message:"Please select page type"}),email_address:o.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:o.string().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:o.string({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:o.string({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:o.string().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:o.string().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:o.any(),state_code:o.any(),state_text:o.any(),country_text:o.any(),city_id:o.any(),established:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:o.string().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:o.any(),phone:o.string().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),intro:o.any(),category:o.string().min(2,{message:"Please select a business category"}),business_phrases:o.union([o.literal(""),o.string({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:o.any(),services:o.any(),xsocial:o.any(),fbsocial:o.any(),linksocial:o.any(),website:o.string().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,g)=>{var c,p;((c=e==null?void 0:e.address_two)==null?void 0:c.length)!==0&&((p=e==null?void 0:e.address_two)==null?void 0:p.length)<3&&g.addIssue({code:o.ZodIssueCode.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),Me=[{name:"Local Business or Place",id:"local_business",icon:s.jsx(ce,{size:20})},{name:"Company, Organization or Institution",id:"company_organization_institution",icon:s.jsx(ue,{size:20})},{name:"Non-Governmental Organization",id:"ngo",icon:s.jsx(me,{size:20})},{name:"Artist, Band or Public Figure",id:"artist_band_public_figure",icon:s.jsx(de,{size:20})},{name:"Entertainment",id:"entertainment",icon:s.jsx(ge,{size:20})},{name:"Cause or Community",id:"cause_or_community",icon:s.jsx(pe,{size:20})}],ze=({listing:e,user:g,businessProfileBgData:c})=>{let p="";c!=null&&c.image_url&&(p=W.IMG_BASE_URL+c.image_url);const[x,U]=t.useState(p),[C,B]=t.useState(null),w=t.useRef(null),[T,j]=t.useState(!1),[P,h]=t.useState(!1);q();const{showOperation:M,showSuccess:S,showError:y,showWarning:A,showInfo:L,completeOperation:d}=H(),D=()=>{var r;(r=w.current)==null||r.click()},_=r=>{var m;const u=(m=r.target.files)==null?void 0:m[0];if(u){const l=URL.createObjectURL(u);U(l),B(u),j(!0)}},O=async()=>{h(!0),M("processing"),await new Promise(u=>setTimeout(u,1e3));const r=new FormData;if(T){r.append("file",C),r.append("guid",g.user_guid),r.append("bid",e.gid);const m=W.IMG_BASE_URL+"/business_profile_bg_upload";try{const l=await fetch(m,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(l.ok)S("Success","Image uploaded."),d();else{let z=l.json().then(I=>{y("Error",I.message),d()})}}catch(l){console.log(l.message),y("Error","Image upload failed."),d()}finally{h(!1)}}else y("Error","Please select an image to continue."),d(),h(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative bg-gray-700 w-full h-[200px] z-[0] shadow-lg text-white flex place-items-center place-content-center flex-col",children:[x===""&&"Add Photo (1920x200)",x&&s.jsx("img",{src:x,alt:"",className:"object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:w,className:" hidden",onChange:_})]}),s.jsxs("div",{className:` flex place-items-center gap-1.5
                place-content-center top-[5px] right-[5px] w-fit z-[120] absolute`,children:[s.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:P,onMouseDown:D,children:"Browse"}),s.jsx("button",{className:` bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:O,disabled:P,children:P?"Uploading...":"Upload"})]})]})},ke=({listing:e,user:g,businessProfileImageData:c})=>{let p="";c.image_url&&(p=W.IMG_BASE_URL+c.image_url);const[x,U]=t.useState(p),[C,B]=t.useState(null),w=t.useRef(null),[T,j]=t.useState(!1),[P,h]=t.useState(!1);q();const{showOperation:M,showSuccess:S,showError:y,showWarning:A,showInfo:L,completeOperation:d}=H(),D=()=>{var r;(r=w.current)==null||r.click()},_=r=>{var m;const u=(m=r.target.files)==null?void 0:m[0];if(u){const l=URL.createObjectURL(u);U(l),B(u),j(!0)}},O=async()=>{h(!0),M("processing"),await new Promise(u=>setTimeout(u,1e3));const r=new FormData;if(T){r.append("file",C),r.append("guid",g.user_guid),r.append("bid",e.gid);const m=W.IMG_BASE_URL+"/business_profile_pic_upload";try{const l=await fetch(m,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(l.ok)S("Success","Image uploaded."),d();else{let z=l.json().then(I=>{y("Error",I.message),d()})}}catch{y("Error","Image upload failed"),d()}finally{h(!1)}}else y("Error","Please select an image to continue."),d(),h(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:x,alt:"",className:`object-cover w-full h-full z-0 absolute ${x===""?"bg-black":"bg-white"}`}),s.jsx("input",{type:"file",accept:"image/*",ref:w,className:" hidden",onChange:_}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:D,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(fe,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${P?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:O,disabled:P,children:P?"Uploading...":"Upload"})})]})},Le=({data:e})=>{var Q,X;const[g,c]=t.useState(null),[p,x]=t.useState(!1);q();const[U,C]=t.useState(null),[B,w]=t.useState(!1),{showOperation:T,showSuccess:j,showError:P,showWarning:h,showInfo:M,completeOperation:S}=H(),y=e.countries;let[A,L]=t.useState(e.states),[d,D]=t.useState(e.cities);const _=(Q=he)==null?void 0:Q.sort((f,E)=>f.name.localeCompare(E.name)),[O,r]=t.useState(e.businessProfile.country_code),[u,m]=t.useState(e.businessProfile.state_code),[l,z]=t.useState(""),[I,k]=t.useState(""),R=async f=>{r(f),z(f);const E=await te(f);L(E),$("")},$=async f=>{m(f),k(f);const E=await oe(O,f);D(E)},i=f=>{let E=f.target.value,V=f.target.name;c(v=>({...v,[V]:E}))},Y=async f=>{x(!0),T("processing","Updating page profile"),await new Promise(v=>setTimeout(v,1e3));const E="/api/listing/"+e.businessProfile.gid,V=W.BASE_URL+E;try{const v=await fetch(V,{method:"PUT",headers:be,body:JSON.stringify(f)});if(v.ok)j("Success","Page profile updated."),S();else{const re=await v.text(),ne=JSON.parse(re);throw new Error(`${ne.error}`)}}catch(v){P("error",`${v.message}`),S()}finally{x(!1)}},{register:n,handleSubmit:Z,getValues:G,setValue:N,watch:J,setError:K,formState:{errors:a,isSubmitting:Re}}=Ee({defaultValues:e.businessProfile,resolver:Ce(Ue)});return t.useEffect(()=>{e.businessProfile&&(N("state_code",e.businessProfile.state_code),N("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{l&&(N("state_code",""),N("city_id",""))},[l,e]),t.useEffect(()=>{I&&N("city_id","")},[I]),s.jsxs("div",{children:[s.jsx(De,{isOpen:B,businessGuid:e.businessProfile.gid,userGuid:(X=e.businessProfile)==null?void 0:X.owner}),s.jsx(ze,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData}),s.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:s.jsx("div",{className:"absolute top-[-50px]",children:s.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:s.jsx(ke,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})})}),s.jsxs("div",{children:[s.jsx("hr",{className:"mb-4"}),s.jsxs("div",{className:"relative w-full flex place-items-center gap-1 place-content-end px-[10px]",children:[s.jsx("a",{href:"/web/account/portfolio",className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Portfolio"}),s.jsx("a",{href:`/${e.businessProfile.gid}`,className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Preview"}),(e==null?void 0:e.businessProfile)&&s.jsx(Ae,{setIsOpen:w,guid:e==null?void 0:e.businessProfile.gid,userGuid:e==null?void 0:e.businessProfile.owner})]}),s.jsx("form",{className:"w-full px-[10px]",onSubmit:Z(Y),children:s.jsxs("div",{className:`${Te} mt-0  rounded-lg pt-4 md:max-w-[80%]
                                lg:max-w-[60%] w-full mx-auto `,children:[s.jsx("div",{className:"text-2xl mb-5",children:"Page update"}),s.jsx("div",{className:"text-xl font-[600] leading-[1.4em] px-[10px] text-black mb-[32px]",children:e==null?void 0:e.businessProfile.title}),s.jsx(b,{controlTitle:"Page Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:i,error:a.username,controlInformation:"Choose a username. "}),s.jsx(F,{controlTitle:"Page Type",controlName:"pagetype",controlPlaceholder:"Select Page Type",selectJson:Me,register:n,changeHandler:i,error:a.pagetype,controlInformation:"Select business category."}),s.jsx(b,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:i,error:a.email_address,controlInformation:"Email address is compulsory."}),s.jsx(b,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:i,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(F,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:_,register:n,changeHandler:i,error:a.category,controlInformation:"Select business category."}),s.jsx(b,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:i,error:a.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(b,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:i,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(b,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:i,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx(F,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:y,register:n,changeHandler:i,error:a.country_code,setCode:R,controlInformation:"Country the business was registered. "}),s.jsx(F,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:A,register:n,changeHandler:i,error:a.state_code,setCode:$,controlInformation:"State the business was registered. "}),s.jsx(F,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:d,register:n,changeHandler:i,error:a.city_id,controlInformation:"City the business was registered. "}),s.jsx(b,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:i,error:a.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(b,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:i,error:a.phone,controlInformation:"Mobile number or phone number. "}),s.jsx(b,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:i,error:a.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(b,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:n,changeHandler:i,error:a.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(b,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:n,changeHandler:i,error:a.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(se,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:i,error:a.short_description,setValue:N,getValues:G,watch:J,controlInformationClass:ee,controlInformation:"Short description of business activities"}),s.jsx(se,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:i,error:a.long_description,setValue:N,getValues:G,watch:J,controlInformationClass:ee,controlInformation:"More description about the business."}),s.jsx(b,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:i,error:a.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(Be,{working:p})]})})]})]})},ls=()=>{var z;t.useEffect(()=>{xe(localStorage)},[]);const e=ie(),g=le();if(!g)return null;const c=e.business_guid,p=(z=g==null?void 0:g.user)==null?void 0:z.guid,[x,U]=t.useState(!0),[C,B]=t.useState(null),[w,T]=t.useState(null),[j,P]=t.useState(null),[h,M]=t.useState(null),[S,y]=t.useState(null),[A,L]=t.useState(null),[d,D]=t.useState(null),[_,O]=t.useState(null),[r,u]=t.useState(null),[m,l]=t.useState(null);return ae(),t.useEffect(()=>{async function I(k,R){const $=await we(k||""),i=await Pe(R||""),Y=await ye(),n=i,Z=await te(n.country_code||""),G=await oe(n.country_code||"",n.state_code||""),N=await Se(),J=await je(k||""),K=await _e(R||""),a=await Ie(R||"");B($),T(i),M(Y),P(Z),y(G),L(J),D(K),u(N),O(a)}try{p&&c&&I(p,c)}catch(k){console.log(k.message)}},[p,c]),t.useEffect(()=>{C&&w&&h&&j&&S&&A&&r&&d&&_&&l({userProfile:C,businessProfile:w,countries:h,states:j,cities:S,userProfileImageData:A,businessProfileImageData:d,businessProfileBgData:_,categories:r})},[r,h,j,S,A,d,C,w,_]),t.useEffect(()=>{m&&U(!1)},[m]),x?s.jsx(s.Fragment,{children:s.jsx(Oe,{})}):s.jsx(Ne,{children:s.jsx(ve,{children:m!==null&&s.jsx(Le,{data:m})})})};export{ls as default};
