import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-t0No8UbM.js";import{A}from"./AccountLayout-DBMAEIFw.js";import{u as j}from"./AuthContext-DiZM8Ihb.js";import{a4 as P,W as L,n as W}from"./lib-BT3-1uX3.js";import{u as C,s as I}from"./zod-D-KQcxjf.js";import{I as O,B as T}from"./Input-4a3NgM78.js";import{z as S}from"./index-C4bLmoCR.js";import{f as D,g as F}from"./UserMenu-DrxnraDn.js";import{u as V}from"./NotificationContext-1jS5Nfi7.js";import{u as k}from"./OperationContext-BXLbD7tl.js";import{P as B}from"./ProfileContentLayout-BzJmAScy.js";import{L as U}from"./LoadingMessage-DZ85Xo9V.js";import"./HomeNav-B6uN5o21.js";import"./SrchNavbar-CF-Acj45.js";import"./HamburgerSecondary-C327styB.js";import"./json-DeAxj4L5.js";import"./index-C3rlSFmg.js";import"./BusinessMenu-uzVQD1wl.js";const z=S.object({email:S.string({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),H=({loaderData:n,user:t})=>{var w;const[l,d]=s.useState(null),[o,m]=s.useState(!1);V();const r=j();if(!r)return null;const{showOperation:f,showError:u,completeOperation:a,showSuccess:p}=k(),E=g=>{let h=g.target.value,x=g.target.name;d(c=>({...c,[x]:h}))},b=async g=>{var c;m(!0),f("processing","Sending reset password email"),await new Promise(i=>setTimeout(i,1e3));const x={email:(c=r==null?void 0:r.user)==null?void 0:c.email.trim()};try{const i=await r.resetpw(x);JSON.stringify(i).includes("Error")?(m(!1),u("Error",P(i)),a()):(p("Success",P(i)),a(),await new Promise(R=>setTimeout(R,1e3)),m(!1))}catch{u("Error","Password reset failed. Wait for a minute and retry."),a()}},{register:y,handleSubmit:v,getValues:J,setValue:M,watch:Y,setError:$,formState:{errors:N,isSubmitting:q}}=C({defaultValues:n.userProfile,resolver:I(z)});return e.jsx("form",{onSubmit:v(b),children:e.jsx("div",{className:`${D} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:F,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(w=n.userProfile)==null?void 0:w.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(O,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:y,changeHandler:E,error:N.email}),e.jsx(T,{working:o,value:"Send Reset Email"})]})})})},fe=()=>{s.useEffect(()=>{L(localStorage)},[]);const n=j();if(!n)return null;const{user:t}=n,[l,d]=s.useState(null),[o,m]=s.useState(null),[r,f]=s.useState(!0);return s.useEffect(()=>{async function u(a){const p=await W(a||"");d(p)}try{t!=null&&t.guid&&u(t==null?void 0:t.guid)}catch(a){console.log(a.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{l&&m({userProfile:l})},[l]),s.useEffect(()=>{o&&f(!1)},[o]),r?e.jsx(U,{loading:r}):e.jsx(A,{children:e.jsxs(B,{title:"Reset Password",children:[l===null?"Loading...":"",o&&e.jsx(H,{loaderData:o,user:t})]})})};export{fe as default};
